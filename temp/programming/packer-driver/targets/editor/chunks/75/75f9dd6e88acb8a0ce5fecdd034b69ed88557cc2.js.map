{"version":3,"sources":["file:///Users/playgendary/wn/1/test_rockstone/assets/scripts/Item.ts"],"names":["_decorator","Component","Node","Vec3","director","Animation","ItemType","InputType","Events","ccclass","property","Item","_isDragging","_stopDragging","deltaX","deltaY","onEnable","handleSubscription","onDisable","activated","func","InputC","EventType","TOUCH_START","onDown","INPUT","onInput","typeInput","event","Move","deltaPos","getDeltaX","getDeltaY","newPos","node","position","clone","add","x","y","setPosition","Up","on","ItemSet","onItemSet","emit","ItemDropped","type","ItemChosen","setSiblingIndex","newPosition","off","setType","typeItem","children","active","dropItem","destroy","transformationItem","shine","getComponent","play","scheduleOnce","transferItem","Flower1"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, EventTouch, Vec3, director, Animation, input, Input } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport ItemType from './ItemType';\nimport InputType from './InputType';\nimport Events from './Events';\n\n@ccclass('Item')\nexport class Item extends Component {\n    @property(Node)\n    private shine: Node = null;\n\n    @property(Node)\n    private InputC: Node = null;\n\n    @property\n    public type: ItemType = ItemType.Flower1;\n\n    private _isDragging: boolean = false;\n    private _stopDragging: boolean = false;\n\n    public deltaX: number = 0;\n    public deltaY: number = 0;\n\n    onEnable() {\n        this.handleSubscription(true);\n    }\n\n    onDisable() {\n        this.handleSubscription(false);\n    }\n\n    private handleSubscription(activated) {\n        const func = activated ? 'on' : 'off';\n        this.InputC[func](Node.EventType.TOUCH_START, this.onDown, this);\n        director[func](Events.INPUT, this.onInput, this);\n    }\n\n    onInput(typeInput: InputType, event: EventTouch) {\n        if (!this._isDragging || this._stopDragging) return;\n        switch (typeInput) {\n            case InputType.Move:\n                const deltaPos = new Vec3(event.getDeltaX(), event.getDeltaY(), 0);\n                const newPos = this.node.position.clone().add(deltaPos);\n                if (\n                    newPos.x < -this.deltaX ||\n                    newPos.x > this.deltaX ||\n                    newPos.y < -this.deltaY ||\n                    newPos.y > this.deltaY\n                )\n                    return;\n                this.node.setPosition(newPos.x, newPos.y, 0);\n                break;\n            case InputType.Up:\n                director.on(Events.ItemSet, this.onItemSet, this);\n                director.emit(Events.ItemDropped, this.node, this.type);\n                this._isDragging = false;\n                break;\n        }\n    }\n\n    onDown(event) {\n        if (this._stopDragging) return;\n        this._isDragging = true;\n        director.emit(Events.ItemChosen);\n        this.node.setSiblingIndex(1000);\n    }\n\n    private onItemSet(newPosition: Vec3) {\n        this.node.setPosition(newPosition);\n        director.off(Events.ItemSet, this.onItemSet, this);\n    }\n\n    public setType(typeItem: number) {\n        this.node.children[typeItem].active = true;\n    }\n\n    public dropItem() {\n        this.handleSubscription(false);\n        this.node.destroy();\n    }\n\n    public transformationItem(type: ItemType) {\n        this._stopDragging = true;\n        this.node.children[this.type].active = false;\n        this.shine.active = true;\n        this.shine.getComponent(Animation).play();\n        this.scheduleOnce(() => {\n            this.shine.active = false;\n            this.node.children[type].active = true;\n            this.type = type;\n            this._stopDragging = false;\n        }, 1);\n    }\n\n    public transferItem(newPosition: Vec3) {\n        this.node.setPosition(newPosition);\n    }\n}\n"]}