{"version":3,"sources":["file:///Users/playgendary/wn/1/test_rockstone/assets/scripts/Item.ts"],"names":["_decorator","Component","Node","Vec3","director","Animation","input","Input","ItemType","InputType","Events","ccclass","property","Item","_isDragging","_stopDragging","deltaX","deltaY","onEnable","handleSubscription","on","EventType","TOUCH_START","onTouchStart","event","console","log","getLocation","onDisable","activated","func","InputC","onDown","INPUT","onInput","typeInput","Move","deltaPos","getDeltaX","getDeltaY","newPos","node","position","clone","add","x","y","setPosition","Up","ItemSet","onItemSet","emit","ItemDropped","type","getUILocation","ItemChosen","setSiblingIndex","newPosition","off","setType","typeItem","children","active","dropItem","destroy","transformationItem","shine","getComponent","play","scheduleOnce","transferItem","Flower1"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAkBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,K,OAAAA,K;;AAG7EC,MAAAA,Q;;AACAC,MAAAA,S;;AACAC,MAAAA,M;;;;;;;;;OAJD;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBZ,U;;sBAOjBa,I,WADZF,OAAO,CAAC,MAAD,C,UAEHC,QAAQ,CAACV,IAAD,C,UAGRU,QAAQ,CAACV,IAAD,C,2BALb,MACaW,IADb,SAC0BZ,SAD1B,CACoC;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAUxBa,WAVwB,GAUD,KAVC;AAAA,eAWxBC,aAXwB,GAWC,KAXD;AAAA,eAazBC,MAbyB,GAaR,CAbQ;AAAA,eAczBC,MAdyB,GAcR,CAdQ;AAAA;;AAgBhCC,QAAAA,QAAQ,GAAG;AACP,eAAKC,kBAAL,CAAwB,IAAxB;AACAb,UAAAA,KAAK,CAACc,EAAN,CAASb,KAAK,CAACc,SAAN,CAAgBC,WAAzB,EAAsC,KAAKC,YAA3C,EAAyD,IAAzD;AACH;;AAEDA,QAAAA,YAAY,CAACC,KAAD,EAAQ;AAChBC,UAAAA,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACG,WAAN,EAAZ;AACH;;AAEDC,QAAAA,SAAS,GAAG;AACR,eAAKT,kBAAL,CAAwB,KAAxB;AACH;;AAEOA,QAAAA,kBAAkB,CAACU,SAAD,EAAY;AAClC,gBAAMC,IAAI,GAAGD,SAAS,GAAG,IAAH,GAAU,KAAhC;AACA,eAAKE,MAAL,CAAYD,IAAZ,EAAkB5B,IAAI,CAACmB,SAAL,CAAeC,WAAjC,EAA8C,KAAKU,MAAnD,EAA2D,IAA3D;AACA5B,UAAAA,QAAQ,CAAC0B,IAAD,CAAR,CAAe;AAAA;AAAA,gCAAOG,KAAtB,EAA6B,KAAKC,OAAlC,EAA2C,IAA3C;AACH;;AAEDA,QAAAA,OAAO,CAACC,SAAD,EAAuBX,KAAvB,EAA0C;AAC7C,cAAI,CAAC,KAAKV,WAAN,IAAqB,KAAKC,aAA9B,EAA6C;;AAC7C,kBAAQoB,SAAR;AACI,iBAAK;AAAA;AAAA,wCAAUC,IAAf;AACI,oBAAMC,QAAQ,GAAG,IAAIlC,IAAJ,CAASqB,KAAK,CAACc,SAAN,EAAT,EAA4Bd,KAAK,CAACe,SAAN,EAA5B,EAA+C,CAA/C,CAAjB;AACA,oBAAMC,MAAM,GAAG,KAAKC,IAAL,CAAUC,QAAV,CAAmBC,KAAnB,GAA2BC,GAA3B,CAA+BP,QAA/B,CAAf;AACA,kBACIG,MAAM,CAACK,CAAP,GAAW,CAAC,KAAK7B,MAAjB,IACAwB,MAAM,CAACK,CAAP,GAAW,KAAK7B,MADhB,IAEAwB,MAAM,CAACM,CAAP,GAAW,CAAC,KAAK7B,MAFjB,IAGAuB,MAAM,CAACM,CAAP,GAAW,KAAK7B,MAJpB,EAMI;AACJ,mBAAKwB,IAAL,CAAUM,WAAV,CAAsBP,MAAM,CAACK,CAA7B,EAAgCL,MAAM,CAACM,CAAvC,EAA0C,CAA1C;AACA;;AACJ,iBAAK;AAAA;AAAA,wCAAUE,EAAf;AACI5C,cAAAA,QAAQ,CAACgB,EAAT,CAAY;AAAA;AAAA,oCAAO6B,OAAnB,EAA4B,KAAKC,SAAjC,EAA4C,IAA5C;AACA9C,cAAAA,QAAQ,CAAC+C,IAAT,CAAc;AAAA;AAAA,oCAAOC,WAArB,EAAkC,KAAKX,IAAvC,EAA6C,KAAKY,IAAlD;AACA,mBAAKvC,WAAL,GAAmB,KAAnB;AACA;AAjBR;AAmBH;;AAEDkB,QAAAA,MAAM,CAACR,KAAD,EAAQ;AACVC,UAAAA,OAAO,CAACC,GAAR,CACIF,KAAK,CAAC8B,aAAN,EADJ,EAEI,KAAKb,IAFT,CAGI;AACA;AACA;AALJ;AAOA,cAAI,KAAK1B,aAAT,EAAwB;AACxB,eAAKD,WAAL,GAAmB,IAAnB;AACAV,UAAAA,QAAQ,CAAC+C,IAAT,CAAc;AAAA;AAAA,gCAAOI,UAArB;AACA,eAAKd,IAAL,CAAUe,eAAV,CAA0B,IAA1B;AACH;;AAEON,QAAAA,SAAS,CAACO,WAAD,EAAoB;AACjC,eAAKhB,IAAL,CAAUM,WAAV,CAAsBU,WAAtB;AACArD,UAAAA,QAAQ,CAACsD,GAAT,CAAa;AAAA;AAAA,gCAAOT,OAApB,EAA6B,KAAKC,SAAlC,EAA6C,IAA7C;AACH;;AAEMS,QAAAA,OAAO,CAACC,QAAD,EAAmB;AAC7B,eAAKnB,IAAL,CAAUoB,QAAV,CAAmBD,QAAnB,EAA6BE,MAA7B,GAAsC,IAAtC;AACH;;AAEMC,QAAAA,QAAQ,GAAG;AACd,eAAK5C,kBAAL,CAAwB,KAAxB;AACA,eAAKsB,IAAL,CAAUuB,OAAV;AACH;;AAEMC,QAAAA,kBAAkB,CAACZ,IAAD,EAAiB;AACtC,eAAKtC,aAAL,GAAqB,IAArB;AACA,eAAK0B,IAAL,CAAUoB,QAAV,CAAmB,KAAKR,IAAxB,EAA8BS,MAA9B,GAAuC,KAAvC;AACA,eAAKI,KAAL,CAAWJ,MAAX,GAAoB,IAApB;AACA,eAAKI,KAAL,CAAWC,YAAX,CAAwB9D,SAAxB,EAAmC+D,IAAnC;AACA,eAAKC,YAAL,CAAkB,MAAM;AACpB,iBAAKH,KAAL,CAAWJ,MAAX,GAAoB,KAApB;AACA,iBAAKrB,IAAL,CAAUoB,QAAV,CAAmBR,IAAnB,EAAyBS,MAAzB,GAAkC,IAAlC;AACA,iBAAKT,IAAL,GAAYA,IAAZ;AACA,iBAAKtC,aAAL,GAAqB,KAArB;AACH,WALD,EAKG,CALH;AAMH;;AAEMuD,QAAAA,YAAY,CAACb,WAAD,EAAoB;AACnC,eAAKhB,IAAL,CAAUM,WAAV,CAAsBU,WAAtB;AACH;;AArG+B,O;;;;;iBAEV,I;;;;;;;iBAGC,I;;+EAEtB7C,Q;;;;;iBACuB;AAAA;AAAA,oCAAS2D,O","sourcesContent":["import { _decorator, Component, Node, EventTouch, Vec3, director, Animation, input, Input } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport ItemType from './ItemType';\nimport InputType from './InputType';\nimport Events from './Events';\n\n@ccclass('Item')\nexport class Item extends Component {\n    @property(Node)\n    private shine: Node = null;\n\n    @property(Node)\n    private InputC: Node = null;\n\n    @property\n    public type: ItemType = ItemType.Flower1;\n\n    private _isDragging: boolean = false;\n    private _stopDragging: boolean = false;\n\n    public deltaX: number = 0;\n    public deltaY: number = 0;\n\n    onEnable() {\n        this.handleSubscription(true);\n        input.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\n    }\n\n    onTouchStart(event) {\n        console.log(event.getLocation());\n    }\n\n    onDisable() {\n        this.handleSubscription(false);\n    }\n\n    private handleSubscription(activated) {\n        const func = activated ? 'on' : 'off';\n        this.InputC[func](Node.EventType.TOUCH_START, this.onDown, this);\n        director[func](Events.INPUT, this.onInput, this);\n    }\n\n    onInput(typeInput: InputType, event: EventTouch) {\n        if (!this._isDragging || this._stopDragging) return;\n        switch (typeInput) {\n            case InputType.Move:\n                const deltaPos = new Vec3(event.getDeltaX(), event.getDeltaY(), 0);\n                const newPos = this.node.position.clone().add(deltaPos);\n                if (\n                    newPos.x < -this.deltaX ||\n                    newPos.x > this.deltaX ||\n                    newPos.y < -this.deltaY ||\n                    newPos.y > this.deltaY\n                )\n                    return;\n                this.node.setPosition(newPos.x, newPos.y, 0);\n                break;\n            case InputType.Up:\n                director.on(Events.ItemSet, this.onItemSet, this);\n                director.emit(Events.ItemDropped, this.node, this.type);\n                this._isDragging = false;\n                break;\n        }\n    }\n\n    onDown(event) {\n        console.log(\n            event.getUILocation(),\n            this.node\n            // event.touch.getLocation().x,\n            // event.touch.getLocationInView().x,\n            // this.node.parent.worldPosition.x\n        );\n        if (this._stopDragging) return;\n        this._isDragging = true;\n        director.emit(Events.ItemChosen);\n        this.node.setSiblingIndex(1000);\n    }\n\n    private onItemSet(newPosition: Vec3) {\n        this.node.setPosition(newPosition);\n        director.off(Events.ItemSet, this.onItemSet, this);\n    }\n\n    public setType(typeItem: number) {\n        this.node.children[typeItem].active = true;\n    }\n\n    public dropItem() {\n        this.handleSubscription(false);\n        this.node.destroy();\n    }\n\n    public transformationItem(type: ItemType) {\n        this._stopDragging = true;\n        this.node.children[this.type].active = false;\n        this.shine.active = true;\n        this.shine.getComponent(Animation).play();\n        this.scheduleOnce(() => {\n            this.shine.active = false;\n            this.node.children[type].active = true;\n            this.type = type;\n            this._stopDragging = false;\n        }, 1);\n    }\n\n    public transferItem(newPosition: Vec3) {\n        this.node.setPosition(newPosition);\n    }\n}\n"]}